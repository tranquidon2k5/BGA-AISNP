\subsection{Lựa chọn các SNP thông tin tổ tiên}

Phương pháp tổng thể của nghiên cứu được chia thành hai giai đoạn chính. Giai đoạn thứ nhất là lựa chọn tập SNP thông tin tổ tiên tiềm năng từ dữ liệu toàn hệ gen. Giai đoạn thứ hai là xây dựng mô hình học máy phân cấp nhằm suy luận nguồn gốc tổ tiên theo hai mức: mức châu lục và mức quần thể trong từng châu lục.

Sàng lọc ban đầu các locus AISNP trên dữ liệu 1000 Genomes Project Phase 3 được thực hiện ở mức toàn hệ gen bằng pipeline GEN (dựa trên đọc VCF và thư viện scikit‑allel). Các điều kiện cơ bản để lựa chọn locus AISNP như sau: (1) locus nằm trên nhiễm sắc thể thường và là marker SNP lưỡng bội, chỉ có một alen tham chiếu và một alen thay thế (biallelic SNP); (2) tần số alen thiểu số (MAF) của locus lớn hơn 0,01; (3) khoảng cách vật lý giữa hai locus bất kỳ trên cùng một nhiễm sắc thể lớn hơn 10 Mb và các cặp locus thỏa mãn trạng thái cân bằng liên kết (liên kết mất cân bằng ở mức r² nhỏ hơn 0,4); (4) tất cả các locus AISNP được chọn đều thỏa mãn cân bằng Hardy–Weinberg (HWE) trong mọi quần thể tham chiếu (p ≥ 1×10⁻⁴); (5) giữa các cặp siêu quần thể thuộc các lục địa khác nhau, các locus có giá trị δ (chênh lệch tần số alen) lớn hơn 0,5; (6) giữa AMR và các siêu quần thể khác, cũng như giữa EUR và SAS, các locus có δ lớn hơn 0,3; (7) giữa các quần thể Đông Á (EAS), các locus có δ lớn hơn 0,25, và trên mỗi nhiễm sắc thể ưu tiên giữ lại tối đa 10 locus có giá trị δ cao nhất nhưng vẫn đảm bảo khoảng cách > 10 Mb và r² < 0,4 thông qua bước prune LD. Ngoài ra, một số locus AISNP từ các nghiên cứu đã công bố trước đây được bổ sung thông qua danh sách rsID whitelist , sau đó loại bỏ các locus trùng lặp và các cặp locus trong trạng thái mất cân bằng liên kết mạnh, thu được tập hợp cuối cùng 296 AISNP có tiềm năng cao cho suy luận nguồn gốc di truyền.

Để làm đầu vào thống nhất cho các mô hình, kiểu gen của mỗi locus AISNP được mã hóa lại dưới dạng số nguyên 0–1–2. Cụ thể, với mỗi SNP, alen phổ biến nhất trong tập tham chiếu được chọn làm alen tham chiếu; mỗi cá thể được gán giá trị 0 nếu mang kiểu gen đồng hợp tham chiếu, 1 nếu mang kiểu gen dị hợp và 2 nếu mang kiểu gen đồng hợp alen thay thế. Các kiểu gen thiếu được xử lý bằng phép thế giá trị trung vị theo từng cột SNP. Bước chuẩn hóa này giúp biến đổi ma trận kiểu gen ban đầu thành ma trận đặc trưng số có kích thước cố định (số hàng bằng số cá thể, số cột bằng số AISNP), thuận tiện cho việc huấn luyện các mô hình học máy ở các giai đoạn tiếp theo.

Từ tập 296 AISNP này, chúng tôi tiếp tục thực hiện một bước chọn lọc dựa trên mô hình (model-based feature selection) sau khi huấn luyện các mô hình suy luận tổ tiên. Cụ thể, ở giai đoạn 1, mô hình XGBoost đa lớp cho phân loại siêu quần thể (AFR, AMR, EAS, EUR, SAS) được huấn luyện trên ma trận kiểu gen chuẩn hóa của 296 AISNP, sau đó trích xuất giá trị độ quan trọng đặc trưng (feature importance) cho từng SNP. Các SNP có độ quan trọng vượt qua một ngưỡng tối thiểu được chọn làm tập AISNP giàu thông tin cho phân biệt mức châu lục. Ở giai đoạn 2, với mỗi châu lục, một mô hình XGBoost cho phân loại các quần thể tham chiếu trong châu lục đó được huấn luyện riêng, và độ quan trọng của từng SNP lại được tính toán độc lập cho từng mô hình khu vực. Các SNP vượt ngưỡng quan trọng trong từng mô hình khu vực này được tập hợp thành các bảng AISNP chuyên biệt theo châu lục, phản ánh những locus mang thông tin phân giải tốt nhất cho phân biệt các quần thể trong cùng một lục địa. Cách tiếp cận hai bước (sàng lọc theo thống kê quần thể, sau đó tinh chỉnh bằng độ quan trọng từ mô hình học máy) cho phép vừa đảm bảo các ràng buộc di truyền dân số (MAF, HWE, LD, δ) vừa tận dụng được cấu trúc quyết định của mô hình để thu được những tập AISNP gọn nhưng giàu thông tin cho suy luận tổ tiên.
